(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{482:function(e,t,o){e.exports=o.p+"assets/img/1-boot-efi.853f625b.png"},483:function(e,t,o){e.exports=o.p+"assets/img/2-kernel-start.e0572033.png"},484:function(e,t,o){e.exports=o.p+"assets/img/5-apfs-module.b0425a3e.png"},485:function(e,t,o){e.exports=o.p+"assets/img/6-USB-setup.ba302241.png"},486:function(e,t,o){e.exports=o.p+"assets/img/8-dsmos-arrived.847041e0.png"},487:function(e,t,o){e.exports=o.p+"assets/img/9-audio.6e453f41.png"},488:function(e,t,o){e.exports=o.p+"assets/img/10-GPU.8e1643f9.png"},489:function(e,t,o){e.exports=o.p+"assets/img/11-boot.b02845ce.png"},604:function(e,t,o){"use strict";o.r(t);var s=o(10),r=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"了解macos引导过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#了解macos引导过程"}},[e._v("#")]),e._v(" 了解macOS引导过程")]),e._v(" "),t("p",[e._v("在对hackintosh进行故障诊断时，要真正理解您在"),t("strong",[e._v("哪里")]),e._v("遇到困难可能有点困难，因为您试图搜索的确切关键字可能与谷歌上的任何内容都不匹配。虽然这篇文章不会解决你所有的问题，但它至少可以帮助你更好地理解macOS启动过程中哪里卡住了，并希望能给你一些为什么卡住的想法。")]),e._v(" "),t("h2",{attrs:{id:"opencore启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#opencore启动"}},[e._v("#")]),e._v(" OpenCore启动")]),e._v(" "),t("p",[e._v("本节将会很简短，因为OpenCore引导问题相当罕见，通常是简单的用户错误:")]),e._v(" "),t("ul",[t("li",[e._v("系统启动并搜索启动设备")]),e._v(" "),t("li",[e._v("系统在您的 OpenCore USB 上的 efi/BOOT/ 下定位 BOOTx64.efi")]),e._v(" "),t("li",[e._v("加载BOOT x64.efi，然后从 efi/OC/ 链式加载 OpenCore.efi")]),e._v(" "),t("li",[e._v("应用NVRAM属性")]),e._v(" "),t("li",[e._v("EFI 驱动程序是从 EFI/OC/drivers 加载的")]),e._v(" "),t("li",[e._v("安装了图形输出协议(GOP)")]),e._v(" "),t("li",[e._v("ACPI 表是从 EFI/OC/ACPI 加载的")]),e._v(" "),t("li",[e._v("SMBIOS数据应用")]),e._v(" "),t("li",[e._v("OpenCore 加载和显示所有可能的引导选项")]),e._v(" "),t("li",[e._v("你现在启动你的macOS安装程序")])]),e._v(" "),t("p",[e._v("如果你在这一点上启动有问题，主要检查:")]),e._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/opencore-issues.html#stuck-on-no-vault-provided"}},[e._v("卡在 "),t("code",[e._v("no vault provided!")])])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/opencore-issues.html#can-t-see-macos-partitions"}},[e._v("看不到 macOS 分区")])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/opencore-issues.html#booting-opencore-reboots-to-bios"}},[e._v("引导 OpenCore 重启到 BIOS")])],1)]),e._v(" "),t("p",[e._v("关于其他可能的问题，请参见:")]),e._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/opencore-issues.html"}},[e._v("OpenCore 启动问题")])],1)]),e._v(" "),t("h2",{attrs:{id:"boot-efi-切换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#boot-efi-切换"}},[e._v("#")]),e._v(" boot.efi 切换")]),e._v(" "),t("p",[t("img",{attrs:{src:o(482),alt:""}})]),e._v(" "),t("p",[e._v("这是macOS的引导加载程序(boot.efi)出现的地方，具体来说，它所做的是为内核加载准备环境，以及OpenCore注入kext的地方。如果你在这一点上卡住了，很可能是加载内核有问题，主要的罪魁祸首是:")]),e._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html#stuck-on-endrandomseed"}},[e._v("卡在 EndRandomSeed")])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html#stuck-on-eb-log-exitbs-start"}},[e._v("卡在 "),t("code",[e._v("[EB|#LOG:EXITBS:START]")])])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html#couldn-t-allocate-runtime-area-errors"}},[e._v("收到 "),t("code",[e._v("Couldn't allocate runtime area")]),e._v(" errors")])],1)]),e._v(" "),t("p",[e._v("关于其他可能的问题，请参见:")]),e._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html"}},[e._v("内核问题")])],1)]),e._v(" "),t("p",[t("strong",[e._v("注意")]),e._v(":在macOS 10.15.4中，苹果更改了boot.efi调试协议，所以看起来与之前有很大的不同，但所有的规则仍然适用")]),e._v(" "),t("h2",{attrs:{id:"xnu-内核切换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#xnu-内核切换"}},[e._v("#")]),e._v(" XNU/内核切换")]),e._v(" "),t("p",[e._v("现在启动efi已经为我们设置好了一切，我们现在可以观察内核的工作了。这部分通常被称为"),t("a",{attrs:{href:"https://developer.apple.com/library/archive/documentation/Darwin/Conceptual/KernelProgramming/booting/booting.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Rooting phase"),t("OutboundLink")],1),e._v(":")]),e._v(" "),t("p",[t("img",{attrs:{src:o(483),alt:""}})]),e._v(" "),t("p",[e._v("本节是验证 SMBIOS 数据、加载 ACPI 表 /kext 以及 macOS 试图使一切正常的地方。这里的失败通常是以下原因造成的:")]),e._v(" "),t("ul",[t("li",[e._v("损坏的ssdt")]),e._v(" "),t("li",[e._v("损坏的kext(或配置文件plist -> Kernel -> Add下的设置不正确)")]),e._v(" "),t("li",[e._v("混乱的内存映射")])]),e._v(" "),t("p",[e._v("查看此处获取更多故障诊断信息:")]),e._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html#kernel-panic-cannot-perform-kext-summary"}},[e._v("卡在 Kernel Panic "),t("code",[e._v("Cannot perform kext summary")])])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html#kernel-panic-on-invalid-frame-pointer"}},[e._v("卡在 Kernel Panic on "),t("code",[e._v("Invalid frame pointer")])])],1)]),e._v(" "),t("p",[t("img",{attrs:{src:o(484),alt:""}})]),e._v(" "),t("p",[e._v("现在我们有了"),t("code",[e._v("[PCI configuration begin]")]),e._v("，这一节可以看作是对我们的系统、注入的kext和ssdt的硬件测试，IOKit在这里启动硬件探测以查找要连接的设备。")]),e._v(" "),t("p",[e._v("这里测试的主要内容是:")]),e._v(" "),t("ul",[t("li",[e._v("嵌入式控制器")]),e._v(" "),t("li",[e._v("存储(NVMe、SATA等)")]),e._v(" "),t("li",[e._v("PCI/e")]),e._v(" "),t("li",[e._v("NVRAM")]),e._v(" "),t("li",[e._v("RTC")]),e._v(" "),t("li",[e._v("PS2 和 I2C")])]),e._v(" "),t("p",[e._v("关于如何绕过这个区域的更多具体信息，请参阅这里:")]),e._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html#stuck-on-rtc-pci-configuration-begins-previous-shutdown-hpet-hid-legacy"}},[e._v("卡在 "),t("code",[e._v("RTC...")]),e._v(", "),t("code",[e._v("PCI Configuration Begins")]),e._v(", "),t("code",[e._v("Previous Shutdown...")]),e._v(", "),t("code",[e._v("HPET")]),e._v(", "),t("code",[e._v("HID: Legacy...")])])],1)]),e._v(" "),t("p",[t("img",{attrs:{src:o(485),alt:""}})]),e._v(" "),t("p",[e._v('这就是15端口限制和USB映射发挥作用的地方，也是臭名昭著的 "Waiting for Root Device" 错误弹出的地方，主要检查:')]),e._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html#waiting-for-root-device-or-prohibited-sign-error"}},[e._v('"Waiting for Root Device" 或禁止符号错误')])],1)]),e._v(" "),t("p",[t("img",{attrs:{src:o(486),alt:""}})]),e._v(" "),t("p",[e._v("这就是我们的FakeSMC/VirtualSMC发挥作用的地方，DSMOS本身是一个kext，它验证您的系统是否有一个SMC，并将请求一个密钥。如果这个密钥缺失，那么DSMOS将无法解密其余的二进制文件，您将被卡在这里。你也可能在AppleACPICPU遇到同样的错误。")]),e._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html#kextd-stall-0-appleacpicpu"}},[e._v("kextd stall[0]: AppleACPICPU")])],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("你今天的业力检查:\n曾经有一个用户抱怨\n他现有的操作系统太盲目了,\n他会做得更好,盗版操作系统跑好了\n但他发现硬件拒绝。\n请不要偷Mac OS!\n真的，这太不酷了。\n(C) Apple Computer, Inc.\n")])])]),t("p",[e._v("来源:不要窃取Mac OS X.kext")]),e._v(" "),t("p",[t("img",{attrs:{src:o(487),alt:""}})]),e._v(" "),t("p",[e._v("这就是苹果的音频驱动程序和AppleALC的亮点所在。通常很少在这里看到问题，但如果有，请尝试禁用AppleALC和任何其他与音频相关的kext。")]),e._v(" "),t("p",[t("img",{attrs:{src:o(488),alt:""}})]),e._v(" "),t("p",[e._v("这里我们进入了GPU驱动程序初始化，WhateverGreen也在这里发挥了它的魔力。这里的错误通常是由于GPU，而不是WhateverGreen本身，主要的罪魁祸首:")]),e._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html#stuck-on-or-near-ioconsoleusers-gioscreenlock-giolockstate-3"}},[e._v("卡在或靠近 "),t("code",[e._v("IOConsoleUsers: gIOScreenLock...")])])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html#black-screen-after-ioconsoleusers-gioscreenlock-on-navi"}},[t("code",[e._v("IOConsoleUsers: gIOScreenLock...")]),e._v("后出现黑屏…")])],1)]),e._v(" "),t("h2",{attrs:{id:"macos-handoff"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#macos-handoff"}},[e._v("#")]),e._v(" macOS Handoff")]),e._v(" "),t("p",[t("img",{attrs:{src:o(489),alt:""}})]),e._v(" "),t("p",[e._v("你终于摆脱了所有的啰嗦!如果在啰嗦模式过去了这么多之后，你还在纠结于苹果的logo，那么有几件事需要检查:")]),e._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html#macos-frozen-right-before-login"}},[e._v("macOS 在登录前冻结")])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/kernel-issues.html#black-screen-after-ioconsoleusers-gioscreenlock-on-navi"}},[t("code",[e._v("IOConsoleUsers: gIOScreenLock...")]),e._v(" 后出现黑屏…")])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/userspace-issues.html#frozen-in-the-macos-installer-after-30-seconds"}},[e._v("在macOS安装程序30秒后冻结")])],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);