(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{508:function(e,t,a){e.exports=a.p+"assets/img/serial-header.f60954b5.png"},509:function(e,t,a){e.exports=a.p+"assets/img/serial-connector.6e514758.jpg"},510:function(e,t,a){e.exports=a.p+"assets/img/817DNdBZDkL._AC_SL1500_.af22055f.jpg"},511:function(e,t,a){e.exports=a.p+"assets/img/61yHczOwpTL._AC_SL1001_.f84613fd.jpg"},512:function(e,t,a){e.exports=a.p+"assets/img/coolterm-first-start.9ab65697.png"},513:function(e,t,a){e.exports=a.p+"assets/img/coolterm-settings.2c1445fe.png"},514:function(e,t,a){e.exports=a.p+"assets/img/coolterm-connect.fb665577.png"},515:function(e,t,a){e.exports=a.p+"assets/img/coolterm-record.f7e0709b.png"},516:function(e,t,a){e.exports=a.p+"assets/img/more-downloads.edd8905d.png"},517:function(e,t,a){e.exports=a.p+"assets/img/kdk-install.015e9b14.png"},518:function(e,t,a){e.exports=a.p+"assets/img/kdk-installed.41bf377f.png"},609:function(e,t,a){"use strict";a.r(t);var s=a(10),r=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"系统调试-深入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#系统调试-深入"}},[e._v("#")]),e._v(" 系统调试:深入")]),e._v(" "),t("p",[e._v("本节将更深入地讨论故障排除，特别关注具有适当调试输出和可选串行设置的更低级的调试。")]),e._v(" "),t("p",[t("strong",[e._v("注意")]),e._v(":99%的用户不需要这种级别的调试，这只适用于核心或极端情况。")]),e._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#efi-设置"}},[e._v("EFI 设置")])]),t("li",[t("a",{attrs:{href:"#config-plist-设置"}},[e._v("Config.plist 设置")]),t("ul",[t("li",[t("a",{attrs:{href:"#misc"}},[e._v("Misc")])]),t("li",[t("a",{attrs:{href:"#nvram"}},[e._v("NVRAM")])])])]),t("li",[t("a",{attrs:{href:"#串行设置-可选"}},[e._v("串行设置(可选)")]),t("ul",[t("li",[t("a",{attrs:{href:"#硬件设置"}},[e._v("硬件设置")])]),t("li",[t("a",{attrs:{href:"#coolterm-设置"}},[e._v("CoolTerm 设置")])])])]),t("li",[t("a",{attrs:{href:"#内核调试工具包-可选"}},[e._v("内核调试工具包(可选)")]),t("ul",[t("li",[t("a",{attrs:{href:"#kdk-on-an-installed-os"}},[e._v("KDK on an Installed OS")])]),t("li",[t("a",{attrs:{href:"#uninstalling-the-kdk"}},[e._v("Uninstalling the KDK")])])])])])]),t("p"),e._v(" "),t("h2",{attrs:{id:"efi-设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#efi-设置"}},[e._v("#")]),e._v(" EFI 设置")]),e._v(" "),t("p",[e._v("在大多数情况下，只需要相当小的更改。我们主要推荐的是DEBUG版本的"),t("strong",[e._v("OpenCore")]),e._v("和所有的"),t("strong",[e._v("kext")]),e._v("。这可以帮助您获得所有必要的数据，有关OpenCore调试的更多详细信息，请参阅这里: "),t("RouterLink",{attrs:{to:"/troubleshooting/debug.html"}},[e._v("OpenCore调试")])],1),e._v(" "),t("p",[e._v("除了使用OpenCore和kexts的DEBUG版本，这些工具也可以提供很大的帮助:")]),e._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://github.com/acidanthera/DebugEnhancer/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("DebugEnhancer.kext"),t("OutboundLink")],1)]),e._v(" "),t("ul",[t("li",[e._v("极大地帮助内核调试，同时还修补了 "),t("a",{attrs:{href:"https://github.com/acidanthera/DebugEnhancer/blob/4495911971011a1a7a0ffe8605d6ca4b341f67d9/DebugEnhancer/kern_dbgenhancer.cpp#L131",target:"_blank",rel:"noopener noreferrer"}},[e._v("kern.msgbuf to 10485760"),t("OutboundLink")],1),e._v(" ，并允许更大的内核日志。")]),e._v(" "),t("li",[e._v("注意这个kext不能与内核初始化一起启动，所以早期的日志不会被修补，直到kext在PCI配置阶段之前加载")])])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://gist.github.com/al3xtjames/39ebea4d615c8aed829109a9ea2cd0b5",target:"_blank",rel:"noopener noreferrer"}},[e._v("SSDT-DBG"),t("OutboundLink")],1)]),e._v(" "),t("ul",[t("li",[e._v("启用ACPI表中的调试语句，帮助操作系统中的ACPI事件调试")]),e._v(" "),t("li",[e._v("注意你需要"),t("a",{attrs:{href:"https://dortania.github.io/Getting-Started-With-ACPI/Manual/compile.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("编译SSDT"),t("OutboundLink")],1)])])])]),e._v(" "),t("h2",{attrs:{id:"config-plist-设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#config-plist-设置"}},[e._v("#")]),e._v(" Config.plist 设置")]),e._v(" "),t("p",[e._v("对于串行设置，OpenCore实际上是非常直接的。")]),e._v(" "),t("h3",{attrs:{id:"misc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#misc"}},[e._v("#")]),e._v(" Misc")]),e._v(" "),t("h4",{attrs:{id:"serial"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#serial"}},[e._v("#")]),e._v(" Serial")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Init")]),e._v(": YES\n"),t("ul",[t("li",[e._v("从 OpenCore 初始化串口")]),e._v(" "),t("li",[e._v("需要将OpenCore日志发送到串口")])])])]),e._v(" "),t("h4",{attrs:{id:"debug"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#debug"}},[e._v("#")]),e._v(" Debug")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Target")]),e._v(": "),t("code",[e._v("67")]),e._v(" "),t("ul",[t("li",[e._v("启用OpenCore调试输出")]),e._v(" "),t("li",[t("code",[e._v("Target")]),e._v(" = "),t("code",[e._v("75")]),e._v("添加额外的串行输出标志("),t("code",[e._v("0x08")]),e._v(")，如果你"),t("a",{attrs:{href:"#serial-setup-optional"}},[e._v("计划使用串行")])]),e._v(" "),t("li",[e._v("你可以在这里计算你自己的值:"),t("RouterLink",{attrs:{to:"/troubleshooting/debug.html"}},[e._v("OpenCore调试")])],1)])])]),e._v(" "),t("h3",{attrs:{id:"nvram"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nvram"}},[e._v("#")]),e._v(" NVRAM")]),e._v(" "),t("h4",{attrs:{id:"boot-args"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#boot-args"}},[e._v("#")]),e._v(" boot-args")]),e._v(" "),t("p",[e._v("在这里，我们要设置一些变量来帮助我们调试输出，对于我们来说，我们将使用以下的boot-args:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("-v keepsyms=1 debug=0x12a msgbuf=1048576\n")])])]),t("p",[e._v("现在让我们来看看每个arg的作用:")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("-v")]),e._v(" "),t("ul",[t("li",[e._v("启用详细输出")])])]),e._v(" "),t("li",[t("strong",[e._v("keepsyms=1")]),e._v(" "),t("ul",[t("li",[e._v("确保在内核发生严重故障时保留符号，这对故障排除非常有帮助")])])]),e._v(" "),t("li",[t("strong",[e._v("debug=0x12a")]),e._v(" "),t("ul",[t("li",[e._v("Combination of "),t("code",[e._v("DB_PRT")]),e._v(" (0x2), "),t("code",[e._v("DB_KPRT")]),e._v(" (0x8), "),t("code",[e._v("DB_SLOG")]),e._v(" (0x20), and "),t("code",[e._v("DB_LOG_PI_SCRN")]),e._v(" (0x100)")]),e._v(" "),t("li",[e._v("最新版本XNU的完整列表可以在这里找到: "),t("a",{attrs:{href:"https://github.com/apple-oss-distributions/xnu/blob/master/osfmk/kern/debug.h",target:"_blank",rel:"noopener noreferrer"}},[e._v("debug.h"),t("OutboundLink")],1)])])]),e._v(" "),t("li",[t("strong",[e._v("msgbuf=1048576")]),e._v(" "),t("ul",[t("li",[e._v("设置内核的消息缓冲区大小，这有助于在启动期间获得正确的日志")]),e._v(" "),t("li",[e._v("1048576 is 1MB(/1024^2), 如果需要可以更大")]),e._v(" "),t("li",[e._v("注意：DebugEnhancer kext不需要，但是对于早期的内核日志，它仍然是必需的")])])])]),e._v(" "),t("p",[t("strong",[e._v("其他有用的boot-args")]),e._v(":")]),e._v(" "),t("p",[e._v("根据你正在调试的内容，你可能还会发现这些boot-args非常有用:")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("-liludbgall")]),e._v(" "),t("ul",[t("li",[e._v("在Lilu和任何其他插件上启用调试，但请注意，这需要调试版本的kext")])])]),e._v(" "),t("li",[t("strong",[e._v("io=0xff")]),e._v(" "),t("ul",[t("li",[e._v("启用IOKit调试，输出更大。请注意，此参数的日志量将非常大，并将降低系统的速度。尤其是在启动的时候。")])])]),e._v(" "),t("li",[t("strong",[e._v("igdebug=0xff")]),e._v(" "),t("ul",[t("li",[e._v("开启iGPU相关的调试，在使用iGPU系统时很有用")])])]),e._v(" "),t("li",[t("strong",[e._v("serial=5")]),e._v(" "),t("ul",[t("li",[e._v("将输出重定向到串行如果你"),t("a",{attrs:{href:"#serial-setup-optional"}},[e._v("计划使用串行")])]),e._v(" "),t("li",[e._v("推荐用于PCI配置之前的早期内核输出")])])]),e._v(" "),t("li",[t("strong",[e._v("acpi_layer=0x8")]),e._v(" "),t("ul",[t("li",[e._v("启用"),t("code",[e._v("ACPI_TABLES")]),e._v("调试，参见"),t("a",{attrs:{href:"https://github.com/acpica/acpica/blob/master/source/include/acoutput.h",target:"_blank",rel:"noopener noreferrer"}},[e._v("acoutput.h"),t("OutboundLink")],1),e._v(" 了解更多信息")]),e._v(" "),t("li",[t("code",[e._v("0xFFFFFFFF")]),e._v(" 也可以启用所有层")])])]),e._v(" "),t("li",[t("strong",[e._v("acpi_level=0x2")]),e._v(" "),t("ul",[t("li",[e._v("设置"),t("code",[e._v("ACPI_LV_DEBUG_OBJECT")]),e._v("调试，参见 "),t("a",{attrs:{href:"https://github.com/acpica/acpica/blob/master/source/include/acoutput.h",target:"_blank",rel:"noopener noreferrer"}},[e._v("acoutput.h"),t("OutboundLink")],1),e._v(" 了解更多信息")]),e._v(" "),t("li",[t("code",[e._v("0xFFFF5F")]),e._v(" 也可以表示 "),t("code",[e._v("ACPI_ALL_COMPONENTS")])])])])]),e._v(" "),t("h2",{attrs:{id:"串行设置-可选"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#串行设置-可选"}},[e._v("#")]),e._v(" 串行设置(可选)")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#hardware-setup"}},[e._v("硬件设置")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#efi-setup"}},[e._v("EFI 设置")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#config-plist-setup"}},[e._v("Config.plist 设置")])])]),e._v(" "),t("p",[e._v("虽然是可选的，但串行仍然对抓取所有的信息超级有帮助。这也是正确记录超早期内核崩溃的唯一方法(例如在"),t("code",[e._v("[EB|# log:EXITBS:START]")]),e._v("之后的事情)")]),e._v(" "),t("p",[e._v("对于这个设置，你需要一些东西:")]),e._v(" "),t("ul",[t("li",[e._v("测试机上的串行头/端口")]),e._v(" "),t("li",[e._v("串行到串行或串行到usb电缆")]),e._v(" "),t("li",[e._v("第二台机器接收串行日志记录(使用串行或USB)")]),e._v(" "),t("li",[e._v("软件监控串行输出\n"),t("ul",[t("li",[e._v("在本指南中，我们将使用 "),t("a",{attrs:{href:"https://freeware.the-meiers.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("CoolTerm"),t("OutboundLink")],1),e._v(" ,因为它支持macOS, Linux, Windows甚至树莓派")]),e._v(" "),t("li",[t("code",[e._v("screen")]),e._v(" 和其他方法也支持")])])])]),e._v(" "),t("h3",{attrs:{id:"硬件设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#硬件设置"}},[e._v("#")]),e._v(" 硬件设置")]),e._v(" "),t("p",[e._v("对于这个例子，我们将使用华硕X299-E Strix板，它有一个串行头。要确认您的单板是否自带串口，请查看单板的所有者或服务手册，并搜索串口/COM端口:")]),e._v(" "),t("p",[t("img",{attrs:{src:a(508),alt:""}})]),e._v(" "),t("p",[e._v("正如你所看到的，我们在主板的底部有一个COM端口，如果你不使用9/10引脚串行头到DB9适配器，甚至为我们手动连接我们的串行引脚提供了一个图表。")]),e._v(" "),t("p",[e._v("或者，一些机器在后IO上带有DB9串行端口，例如这台Dell Optiplex 780 SFF(注意VGA和串行"),t("strong",[e._v("不是")]),e._v("同一个连接器):")]),e._v(" "),t("img",{attrs:{width:"508",alt:"",src:a(509)}}),e._v(" "),t("p",[e._v("对于我的X299设置，我使用一个简单的 "),t("a",{attrs:{href:"https://www.amazon.ca/gp/product/B001Y1F0HW/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&psc=1",target:"_blank",rel:"noopener noreferrer"}},[e._v("串行头到DB9"),t("OutboundLink")],1),e._v(", 然后一个 "),t("a",{attrs:{href:"https://www.amazon.ca/gp/product/B075YGKFC1/ref=ppx_yo_dt_b_asin_title_o00_s01?ie=UTF8&psc=1",target:"_blank",rel:"noopener noreferrer"}},[e._v("DB9到USB RS 232适配器"),t("OutboundLink")],1),e._v(" 最后终止在我的笔记本电脑:")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[e._v("Serial header to DB9")]),e._v(" "),t("th",{staticStyle:{"text-align":"left"}},[e._v("DB9 to USB  RS 232 adapter")])])]),e._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("img",{attrs:{src:a(510),alt:""}})]),e._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("img",{attrs:{src:a(511),alt:""}})])])])]),e._v(" "),t("p",[e._v("OpenCore手册通常建议CP21202-based UART设备:")]),e._v(" "),t("blockquote",[t("p",[e._v("要在引导期间获得日志，可以使用串口调试。在目标中打开串口调试，例如0xB表示onscreen with Serial。OpenCore使用115200波特率，8个数据位，无奇偶校验和1个停止位。对于macOS，最好的选择是基于cp2102的UART设备。将主板TX连接到USB UART RX，主板GND连接到USB UART GND。使用屏幕工具获取输出，或者下载GUI软件，比如CoolTerm。\n注意:在一些主板(可能是USB UART加密狗)PIN命名可能不正确。GND与RX交换是非常常见的，因此您必须将主板“TX”连接到USB UART GND，并将主板“GND”连接到USB UART RX。")])]),e._v(" "),t("p",[t("strong",[e._v("重要提醒")]),e._v(":不要忘记在BIOS中启用串口，大多数主板默认情况下将禁用它")]),e._v(" "),t("h3",{attrs:{id:"coolterm-设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#coolterm-设置"}},[e._v("#")]),e._v(" CoolTerm 设置")]),e._v(" "),t("p",[e._v("现在让我们启动"),t("a",{attrs:{href:"https://freeware.the-meiers.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("CoolTerm"),t("OutboundLink")],1),e._v("并设置一些选项。当您打开CoolTerm时，您可能会看到一个简单的窗口。在这里选择选项条目:")]),e._v(" "),t("p",[t("img",{attrs:{src:a(512),alt:""}}),e._v(" "),t("img",{attrs:{src:a(513),alt:""}})]),e._v(" "),t("p",[e._v("这里给出了很多选项，但我们主要关心的是:")]),e._v(" "),t("ul",[t("li",[e._v("Port: 确保与您的串行控制器匹配。")]),e._v(" "),t("li",[e._v("Baudrate = 115200")]),e._v(" "),t("li",[e._v("Data Bits = 8")]),e._v(" "),t("li",[e._v("Parity = 无")]),e._v(" "),t("li",[e._v("Stop Bit = 1")])]),e._v(" "),t("p",[e._v("接下来，保存这些设置，并选择Connect条目。这将为你提供一个来自serial的实时日志:")]),e._v(" "),t("p",[t("img",{attrs:{src:a(514),alt:"CoolTerm Connect"}})]),e._v(" "),t("p",[e._v("要记录，只需前往 "),t("code",[e._v("Connections -> Capture to Text/Binary File -> Start...(Cmd+R)")]),e._v(":")]),e._v(" "),t("p",[t("img",{attrs:{src:a(515),alt:""}})]),e._v(" "),t("h2",{attrs:{id:"内核调试工具包-可选"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内核调试工具包-可选"}},[e._v("#")]),e._v(" 内核调试工具包(可选)")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#kdk-on-an-installed-os"}},[e._v("KDK on an Installed OS")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#uninstalling-the-kdk"}},[e._v("Uninstalling the KDK")])])]),e._v(" "),t("p",[e._v("内核调试工具包(kdk)是一种从内核和核心kext获取更多日志信息的好方法，kdk具体来说是苹果自己提供的macOS核心基础的调试版本。它们包括更多的日志记录和断言，允许您更直接地查看设置中的问题。但是请注意，我们不会讨论桥接调试或 "),t("code",[e._v("lldb")]),e._v(" 的用法。")]),e._v(" "),t("p",[t("span",{staticStyle:{color:"red"}},[e._v(" CAUTION: ")]),e._v(" Installing KDKs on work machines can lead to issues with OS updates as well as bricked installs. Please debug on dedicated macOS installs to avoid data loss")]),e._v(" "),t("p",[e._v("To start, we'll first need a minimum of a "),t("a",{attrs:{href:"https://developer.apple.com/support/compare-memberships/",target:"_blank",rel:"noopener noreferrer"}},[e._v("free developer account"),t("OutboundLink")],1),e._v(" from Apple. Once you've signed up for a minimum of a free tier, you can now access KDKs from the "),t("a",{attrs:{href:"https://developer.apple.com/download/more/",target:"_blank",rel:"noopener noreferrer"}},[e._v("More Downloads page"),t("OutboundLink")],1),e._v(":")]),e._v(" "),t("ul",[t("li",[e._v("Note: Free tiers will be limited to release KDKs, only beta KDKs are provided for "),t("a",{attrs:{href:"https://developer.apple.com/support/compare-memberships/",target:"_blank",rel:"noopener noreferrer"}},[e._v("paid developer accounts"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("Note 2: Apple hosts KDKs as far back as OS X 10.5, Leopard so don't worry about your OS not being supported")])]),e._v(" "),t("p",[t("img",{attrs:{src:a(516),alt:""}})]),e._v(" "),t("p",[e._v("To determine which KDK build you need with beta builds, run the following in terminal:")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("sw_vers "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" BuildVersion\n")])])]),t("p",[e._v('For this, I will be downloading Kernel Debug Kit 11.3 build 20E5186d. Once downloaded, mount the disk image and you\'ll find the KDK installer. By default, the KDK will only install itself for "Performing Two-Machine Debugging" and will provide zero extra benefit on the host machine for kernel debugging by default.')]),e._v(" "),t("h3",{attrs:{id:"kdk-on-an-installed-os"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kdk-on-an-installed-os"}},[e._v("#")]),e._v(" KDK on an Installed OS")]),e._v(" "),t("p",[e._v("To enable debugging on the host machine, you'll need to do the following:")]),e._v(" "),t("ol",[t("li",[e._v("Run the KDK Install pkg")]),e._v(" "),t("li",[e._v("Disable SIP(OS X 10.11+)")]),e._v(" "),t("li",[e._v("Mount root partition as writable(macOS 10.15+)")]),e._v(" "),t("li",[e._v("Install debug kernel and kexts")]),e._v(" "),t("li",[e._v("Update boot-args")]),e._v(" "),t("li",[e._v("Reboot and check your work")])]),e._v(" "),t("h4",{attrs:{id:"_1-run-the-kdk-install-pkg"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-run-the-kdk-install-pkg"}},[e._v("#")]),e._v(" 1. Run the KDK Install pkg")]),e._v(" "),t("p",[e._v("Simply run the pkg as normal:")]),e._v(" "),t("p",[t("img",{attrs:{src:a(517),alt:""}})]),e._v(" "),t("p",[e._v("Once installed, you'll find the KDK components such as the debug kernel located at "),t("code",[e._v("/Library/Developer/KDKs")]),e._v(":")]),e._v(" "),t("p",[t("img",{attrs:{src:a(518),alt:""}})]),e._v(" "),t("h4",{attrs:{id:"_2-disabling-sip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-disabling-sip"}},[e._v("#")]),e._v(" 2. Disabling SIP")]),e._v(" "),t("ul",[t("li",[e._v("Applicable for OS X 10.11, El Capitan and newer")])]),e._v(" "),t("p",[e._v("To disable SIP, users have 2 choices:")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("Disable via Recovery")])]),e._v(" "),t("li",[t("p",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/post-issues.html#disabling-sip"}},[e._v("Disable via config.plist")])],1)])]),e._v(" "),t("p",[e._v("Generally we highly recommend recovery to easily revert with NVRAM reset, however some users may require SIP to be disabled through NVRAM wipes as well.")]),e._v(" "),t("p",[e._v("For the former, simply reboot into macOS Recovery, open terminal and run the following:")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("csrutil disable\ncsrutil authenticated-root disable "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Big Sur+")]),e._v("\n")])])]),t("p",[e._v("Reboot, and SIP will have been adjusted accordingly. You can run "),t("code",[e._v("csrutil status")]),e._v(" in terminal to verify it worked.")]),e._v(" "),t("ul",[t("li",[t("span",{staticStyle:{color:"red"}},[e._v(" CAUTION: ")]),e._v(" For users relying on "),t("a",{attrs:{href:"https://dortania.github.io/OpenCore-Post-Install/universal/security/applesecureboot.html#apecid",target:"_blank",rel:"noopener noreferrer"}},[e._v("OpenCore's ApECID feature"),t("OutboundLink")],1),e._v(", please be aware this "),t("strong",[e._v("must")]),e._v(" be disabled to use the KDK.")])]),e._v(" "),t("h4",{attrs:{id:"_3-mount-root-partition-as-writable"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-mount-root-partition-as-writable"}},[e._v("#")]),e._v(" 3. Mount root partition as writable")]),e._v(" "),t("ul",[t("li",[e._v("Applicable for macOS 10.15, Catalina and newer")])]),e._v(" "),t("p",[e._v("Mounting the root volume as writable is easy, however the process is a bit long:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Big Sur+")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# First, create a mount point for your drive")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" ~/livemount\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Next, find your System volume")]),e._v("\ndiskutil list\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# From the below list, we can see our System volume is disk5s5")]),e._v("\n/dev/disk5 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("synthesized"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(":\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#:                       TYPE NAME                    SIZE       IDENTIFIER")]),e._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(":      APFS Container Scheme -                      +255.7 GB   disk5\n                                 Physical Store disk4s2\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(":                APFS Volume ⁨Big Sur HD - Data⁩       "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("122.5")]),e._v(" GB   disk5s1\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(":                APFS Volume ⁨Preboot⁩                 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("309.4")]),e._v(" MB   disk5s2\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(":                APFS Volume ⁨Recovery⁩                "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("887.8")]),e._v(" MB   disk5s3\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v(":                APFS Volume ⁨VM⁩                      "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.1")]),e._v(" MB     disk5s4\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v(":                APFS Volume ⁨Big Sur HD⁩              "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("16.2")]),e._v(" GB    disk5s5\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v(":              APFS Snapshot ⁨com.apple.os.update-"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".⁩ "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("16.2")]),e._v(" GB    disk5s5s\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Mount the drive(ie. disk5s5)")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mount")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-o")]),e._v(" nobrowse "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-t")]),e._v(" apfs  /dev/disk5s5 ~/livemount\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Now you can freely make any edits to the System volume")]),e._v("\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Catalina only")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mount")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-uw")]),e._v(" /\n")])])]),t("h4",{attrs:{id:"_4-install-debug-kernel-and-kexts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-install-debug-kernel-and-kexts"}},[e._v("#")]),e._v(" 4. Install debug kernel and kexts")]),e._v(" "),t("p",[e._v("Now we install our KDK into the system:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Install KDK to System Volume")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ensure to replace <KDK Version>")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# For 10.15 and older, swap livemount with /Volumes/<Target Volume>")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ditto /Library/Developer/KDKs/"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("KDK Version"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("/System ~/livemount/System\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Rebuild Truethe kernel cache(Big Sur and newer)")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" kmutil "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" --volume-root ~/livemount --update-all\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Rebuild the kernel cache(Catalina and older)")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" kextcache "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-invalidate")]),e._v(" /Volumes/"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("Target Volume"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Finally, once done editing the system volume")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# we'll want to create a new snapshot (Big Sur and newer)")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" bless "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--folder")]),e._v(" ~/livemount/System/Library/CoreServices "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--bootefi")]),e._v(" --create-snapshot\n")])])]),t("h4",{attrs:{id:"_5-update-boot-args"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-update-boot-args"}},[e._v("#")]),e._v(" 5. Update boot-args")]),e._v(" "),t("p",[e._v("Now that you've finished setting up the KDK and installed it, we now need to tell boot.efi which kernel to use. You have 2 options to choose from:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("kcsuffix=debug")]),e._v(" (removed with Big Sur)")]),e._v(" "),t("li",[t("code",[e._v("kcsuffix=development")])]),e._v(" "),t("li",[t("code",[e._v("kcsuffix=kasan")])])]),e._v(" "),t("p",[t("code",[e._v("development")]),e._v(" arg will set the new default debug kernel in Big Sur, while "),t("code",[e._v("kasan")]),e._v(" is a much more logging intensive kernel that incorporates "),t("a",{attrs:{href:"https://github.com/google/sanitizers/wiki/AddressSanitizer",target:"_blank",rel:"noopener noreferrer"}},[e._v("AddressSanitizer"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("Once you've decided which kernel is ideal for you, add the kcsuffix arg to your boot-args in your config.plist")]),e._v(" "),t("h4",{attrs:{id:"_6-reboot-and-check-your-work"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-reboot-and-check-your-work"}},[e._v("#")]),e._v(" 6. Reboot and check your work")]),e._v(" "),t("p",[e._v("Assuming everything was done correctly, you'll now want to reboot and check that the correct kernel was booted:")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sysctl")]),e._v(" kern.osbuildconfig\n kern.osbuildconfig: kasan\n")])])]),t("p",[e._v("And as we can see, we're successfully booting a KASAN kernel.")]),e._v(" "),t("h3",{attrs:{id:"uninstalling-the-kdk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#uninstalling-the-kdk"}},[e._v("#")]),e._v(" Uninstalling the KDK")]),e._v(" "),t("p",[e._v("Uninstalling the KDK is fairly simple, however can be a bit destructive if not care.")]),e._v(" "),t("ol",[t("li",[e._v("Mount root partition as writable(macOS 10.15+)")]),e._v(" "),t("li",[e._v("Remove debug kernel and kexts")]),e._v(" "),t("li",[e._v("Re-enable SIP")]),e._v(" "),t("li",[e._v("Clean boot-args")]),e._v(" "),t("li",[e._v("Reboot and check your work")])]),e._v(" "),t("p",[e._v("Steps:")]),e._v(" "),t("h4",{attrs:{id:"_1-mount-root-partition-as-writable-macos-10-15"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-mount-root-partition-as-writable-macos-10-15"}},[e._v("#")]),e._v(" 1. Mount root partition as writable(macOS 10.15+)")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Big Sur+")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# First, create a mount point for your drive")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Skip of still present from mounting volume last time")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" ~/livemount\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Next, find your System volume")]),e._v("\ndiskutil list\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# From the below list, we can see our System volume is disk5s5")]),e._v("\n/dev/disk5 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("synthesized"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(":\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#:                       TYPE NAME                    SIZE       IDENTIFIER")]),e._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(":      APFS Container Scheme -                      +255.7 GB   disk5\n                                 Physical Store disk4s2\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(":                APFS Volume ⁨Big Sur HD - Data⁩       "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("122.5")]),e._v(" GB   disk5s1\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(":                APFS Volume ⁨Preboot⁩                 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("309.4")]),e._v(" MB   disk5s2\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(":                APFS Volume ⁨Recovery⁩                "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("887.8")]),e._v(" MB   disk5s3\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v(":                APFS Volume ⁨VM⁩                      "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.1")]),e._v(" MB     disk5s4\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v(":                APFS Volume ⁨Big Sur HD⁩              "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("16.2")]),e._v(" GB    disk5s5\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v(":              APFS Snapshot ⁨com.apple.os.update-"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".⁩ "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("16.2")]),e._v(" GB    disk5s5s\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Mount the drive (ie. disk5s5)")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mount")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-o")]),e._v(" nobrowse "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-t")]),e._v(" apfs  /dev/disk5s5 ~/livemount\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Catalina only")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mount")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-uw")]),e._v(" /\n")])])]),t("h4",{attrs:{id:"_2-remove-debug-kernel-and-kexts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-remove-debug-kernel-and-kexts"}},[e._v("#")]),e._v(" 2. Remove debug kernel and kexts")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Revert to old snapshot (Big Sur+)")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" bless "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--mount")]),e._v(" ~/livemount "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--bootefi")]),e._v(" --last-sealed-snapshot\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Reset kernel cache (Catalina and older)")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("rm")]),e._v(" /System/Library/Caches/com.apple.kext.caches/Startup/kernelcache.de*\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("rm")]),e._v(" /System/Library/PrelinkedKernels/prelinkedkernel.de*\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" kextcache "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-invalidate")]),e._v(" /\n")])])]),t("h4",{attrs:{id:"_3-re-enable-sip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-re-enable-sip"}},[e._v("#")]),e._v(" 3. Re-enable SIP")]),e._v(" "),t("ul",[t("li",[e._v("Recovery commands(if previously changed via recovery):")])]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("csrutil "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("enable")]),e._v("\ncsrutil authenticated-root "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("enable")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Big Sur+")]),e._v("\n")])])]),t("ul",[t("li",[e._v("config.plist changes(if previously changed via config.plist):\n"),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/troubleshooting/extended/post-issues.html#disabling-sip"}},[e._v("Enabling via config.plist")])],1)])])]),e._v(" "),t("h4",{attrs:{id:"_4-clean-boot-args"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-clean-boot-args"}},[e._v("#")]),e._v(" 4. Clean boot-args")]),e._v(" "),t("p",[e._v("Don't forget to remove "),t("code",[e._v("kcsuffix=")]),e._v(" in your boot-args")]),e._v(" "),t("h4",{attrs:{id:"_5-reboot-and-check-your-work"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-reboot-and-check-your-work"}},[e._v("#")]),e._v(" 5. Reboot and check your work")]),e._v(" "),t("p",[e._v("Assuming everything was done correctly, you'll now want to reboot and check that the correct kernel was booted:")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sysctl")]),e._v(" kern.osbuildconfig\n kern.osbuildconfig: release\n")])])]),t("p",[e._v("And as we can see, we're successfully booting a KASAN kernel.")])])}),[],!1,null,null,null);t.default=r.exports}}]);